<div class="x-comment <%= 'has-replies' if comment.replies.any? %>" id="comment-<%= comment.id %>">
  <div class="x-comment-avatar-col">
    <div class="x-avatar"><%= comment.author.display_name_or_username[0].upcase %></div>
    <% if comment.replies.any? %>
      <div class="x-thread-line"></div>
    <% end %>
  </div>
  <div class="x-comment-body-col">
    <div class="x-comment-header">
      <span class="x-display-name"><%= comment.author.display_name_or_username %></span>
      <span class="x-handle">@<%= comment.author.username %></span>
      <span class="x-separator">&middot;</span>
      <span class="x-timestamp"><%= time_ago_in_words(comment.created_at) %></span>
    </div>
    <div class="x-comment-text">
      <%= simple_format(comment.body) %>
    </div>
    <div class="x-action-bar">
      <% if logged_in? && current_user.member_of?(community) && comment.depth < Comment::MAX_DEPTH %>
        <button type="button" class="x-action-btn x-action-reply" onclick="toggleReplyForm(<%= comment.id %>)" title="Reply">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
          <span class="x-action-count"><%= comment.replies.size if comment.replies.size > 0 %></span>
        </button>
      <% end %>

      <% vote_url = commentable.is_a?(Post) ? community_post_comment_comment_vote_path(community, commentable, comment) : community_meme_comment_comment_vote_path(community, commentable, comment) %>
      <% user_vote = logged_in? ? comment.user_vote(current_user) : nil %>

      <% if logged_in? %>
        <%= form_with url: vote_url, method: :post, class: "x-action-form" do %>
          <input type="hidden" name="value" value="1">
          <button type="submit" class="x-action-btn x-action-upvote <%= 'active' if user_vote&.upvote? %>" title="Upvote">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="<%= user_vote&.upvote? ? 'currentColor' : 'none' %>" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round"><path d="M7 17l5-5 5 5"/><path d="M7 12l5-5 5 5" opacity="0"/></svg>
          </button>
        <% end %>
      <% end %>

      <span class="x-action-score <%= 'positive' if comment.score > 0 %><%= 'negative' if comment.score < 0 %>"><%= comment.score %></span>

      <% if logged_in? %>
        <%= form_with url: vote_url, method: :post, class: "x-action-form" do %>
          <input type="hidden" name="value" value="-1">
          <button type="submit" class="x-action-btn x-action-downvote <%= 'active' if user_vote&.downvote? %>" title="Downvote">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="<%= user_vote&.downvote? ? 'currentColor' : 'none' %>" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round"><path d="M7 7l5 5 5-5"/></svg>
          </button>
        <% end %>
      <% end %>

      <% if logged_in? && (comment.author == current_user || current_user.admin_of?(community)) %>
        <% delete_url = commentable.is_a?(Post) ? community_post_comment_path(community, commentable, comment) : community_meme_comment_path(community, commentable, comment) %>
        <%= button_to delete_url, method: :delete, class: "x-action-form", data: { confirm: "Delete this comment?" } do %>
          <span class="x-action-btn x-action-delete" title="Delete">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
          </span>
        <% end %>
      <% end %>
    </div>

    <div class="x-reply-compose" id="reply-form-<%= comment.id %>" style="display: none;">
      <%= render "comments/form", community: community, commentable: commentable, parent_id: comment.id %>
    </div>

    <% if comment.replies.any? %>
      <div class="x-replies">
        <% comment.replies.each do |reply| %>
          <%= render "comments/comment", comment: reply, community: community, commentable: commentable %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
